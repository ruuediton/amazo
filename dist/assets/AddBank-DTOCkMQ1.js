import{r,u as _,s as i,j as e,S as A}from"./index-BauRbZeW.js";const I=({onNavigate:u,showToast:t})=>{const[b,o]=r.useState(""),[p,d]=r.useState(""),[h,x]=r.useState(""),{withLoading:j}=_(),[f,n]=r.useState(!1),[s,g]=r.useState(null),[l,c]=r.useState("create");r.useEffect(()=>{v()},[]);const v=async()=>{n(!0);try{const{data:a}=await i.rpc("get_my_bank_accounts");a&&a.length>0&&(g(a[0]),c("view"))}catch(a){console.error("Erro ao buscar conta:",a)}finally{n(!1)}},w=()=>{s&&(o(s.nome_banco),d(s.nome_completo),x(s.iban),c("edit"))},k=async()=>{if(confirm("Tem certeza que deseja apagar esta conta?")){n(!0);try{const{error:a}=await i.from("bancos_clientes").delete().eq("user_id",s.user_id);if(a)throw a;t==null||t("Conta removida com sucesso!","success"),g(null),o(""),d(""),x(""),c("create")}catch(a){t==null||t("Erro ao deletar: "+(a.message||"Erro desconhecido"),"error")}finally{n(!1)}}},y=a=>{let m=a.target.value.toUpperCase().replace(/[^A-Z0-9]/g,"");x(m)},B=async()=>{try{const a=h.replace(/[^A-Z0-9]/g,"");if(a.length<21){t==null||t("IBAN inválido. Um IBAN angolano deve conter pelo menos 21 caracteres.","error");return}await j(async()=>{const{data:{user:m}}=await i.auth.getUser();if(!m)throw new Error("Sessão expirada. Acesse novamente.");const C={p_bank_name:b,p_holder_name:p,p_iban:a},{error:N}=await i.rpc(l==="edit"?"update_bank_account":"add_bank_account",C);if(N)throw N;t==null||t("Conta bancária vinculada com sucesso!","success"),await v(),setTimeout(()=>u("profile"),1200)},void 0,"Não foi possível salvar os dados bancários.")}catch(a){a.message&&!a.message.includes("loading")&&(t==null||t(a.message,"error"))}};return e.jsxs("div",{className:"font-display antialiased bg-[#0a0a0b] text-white min-h-screen flex flex-col selection:bg-amber-500/30",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-[#0a0a0b]/80 backdrop-blur-xl border-b border-white/5",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("button",{onClick:()=>u("profile"),className:"group flex items-center justify-center w-10 h-10 rounded-full bg-white/5 hover:bg-white/10 active:scale-90 transition-all border border-white/10",children:e.jsx("span",{className:"material-symbols-outlined text-amber-500 text-[22px] group-hover:-translate-x-0.5 transition-transform",children:"arrow_back"})}),e.jsx("h1",{className:"text-[15px] font-black tracking-[0.1em] text-white uppercase",children:l==="view"?"Dados Bancários":l==="edit"?"Editar Conta":"Nova Conta"}),e.jsx("div",{className:"w-10"})]})}),e.jsx("main",{className:"flex-1 flex flex-col w-full max-w-lg mx-auto px-6 pt-8 pb-10",children:l==="view"?e.jsxs("div",{className:"flex flex-col items-center justify-center flex-1 space-y-8 animate-in fade-in zoom-in-95 duration-500",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-amber-500/20 blur-3xl rounded-full"}),e.jsx("div",{className:"relative w-24 h-24 bg-gradient-to-tr from-amber-500 to-amber-200 rounded-3xl flex items-center justify-center shadow-2xl rotate-3",children:e.jsx("span",{className:"material-symbols-outlined text-black text-5xl -rotate-3",children:"account_balance"})})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h2",{className:"text-2xl font-black text-white",children:"Conta Verificada"}),e.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"Seus pagamentos serão enviados para:"})]}),e.jsxs("div",{className:"w-full bg-white/[0.03] backdrop-blur-2xl p-6 rounded-[32px] border border-white/10 shadow-2xl space-y-6 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity",children:e.jsx("span",{className:"material-symbols-outlined text-6xl",children:"verified"})}),e.jsxs("div",{className:"space-y-4 relative",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-amber-500 font-black uppercase tracking-[0.2em] mb-1.5 px-1",children:"Instituição"}),e.jsx("p",{className:"text-lg font-bold text-white bg-white/5 p-3 rounded-2xl border border-white/5",children:s==null?void 0:s.nome_banco})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-amber-500 font-black uppercase tracking-[0.2em] mb-1.5 px-1",children:"Titular"}),e.jsx("p",{className:"text-lg font-bold text-white bg-white/5 p-3 rounded-2xl border border-white/5",children:s==null?void 0:s.nome_completo})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-amber-500 font-black uppercase tracking-[0.2em] mb-1.5 px-1",children:"IBAN de Depósito"}),e.jsx("div",{className:"bg-black/40 p-4 rounded-2xl border border-white/5 group/iban",children:e.jsx("p",{className:"text-sm font-mono font-bold text-amber-200/90 break-all leading-relaxed",children:s==null?void 0:s.iban})})]})]})]}),e.jsxs("div",{className:"flex flex-col w-full gap-3 pt-4",children:[e.jsx("button",{onClick:w,className:"w-full h-14 bg-white text-black text-[13px] font-black uppercase tracking-widest rounded-2xl shadow-xl active:scale-[0.97] transition-all hover:bg-gray-100",children:"Atualizar Dados"}),e.jsx("button",{onClick:k,className:"w-full h-14 bg-transparent text-red-400 text-[13px] font-bold uppercase tracking-widest rounded-2xl border border-red-400/20 hover:bg-red-400/5 transition-all",children:"Remover Conta"})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col animate-in fade-in slide-in-from-bottom-8 duration-700",children:[e.jsxs("div",{className:"mb-8 ",children:[e.jsx("h2",{className:"text-3xl font-black text-white mb-2",children:"Configure seu banco"}),e.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"Assegure que os dados batem com seu BI para evitar atrasos."})]}),e.jsxs("div",{className:"space-y-5 flex-1",children:[e.jsxs("div",{className:"space-y-2 group",children:[e.jsx("label",{className:"block text-[11px] font-black text-gray-500 ml-1 uppercase tracking-widest group-focus-within:text-amber-500 transition-colors",children:"Banco Destinatário"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:b,onChange:a=>o(a.target.value),className:"w-full h-14 pl-4 pr-12 rounded-2xl bg-white/[0.03] border border-white/10 text-[15px] text-white focus:outline-none focus:border-amber-500/50 focus:bg-white/[0.06] transition-all appearance-none",children:[e.jsx("option",{value:"",className:"bg-[#121214]",children:"Escolha seu banco..."}),e.jsx("option",{value:"Banco BAI",className:"bg-[#121214]",children:"Banco BAI"}),e.jsx("option",{value:"Banco BFA",className:"bg-[#121214]",children:"Banco BFA"}),e.jsx("option",{value:"Banco BIC",className:"bg-[#121214]",children:"Banco BIC"}),e.jsx("option",{value:"Banco Atlântico",className:"bg-[#121214]",children:"Banco Atlântico"}),e.jsx("option",{value:"Banco Sol",className:"bg-[#121214]",children:"Banco Sol"}),e.jsx("option",{value:"Banco BNI",className:"bg-[#121214]",children:"Banco BNI"})]}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-amber-500",children:e.jsx("span",{className:"material-symbols-outlined",children:"expand_more"})})]})]}),e.jsxs("div",{className:"space-y-2 group",children:[e.jsx("label",{className:"block text-[11px] font-black text-gray-500 ml-1 uppercase tracking-widest group-focus-within:text-amber-500 transition-colors",children:"Nome do Titular"}),e.jsx("input",{value:p,onChange:a=>d(a.target.value),className:"w-full h-14 px-5 rounded-2xl bg-white/[0.03] border border-white/10 text-[15px] text-white placeholder:text-gray-600 focus:outline-none focus:border-amber-500/50 focus:bg-white/[0.06] transition-all",placeholder:"Ex: João Manuel Silva",type:"text"})]}),e.jsxs("div",{className:"space-y-2 group",children:[e.jsx("label",{className:"block text-[11px] font-black text-gray-500 ml-1 uppercase tracking-widest group-focus-within:text-amber-500 transition-colors",children:"Código IBAN (21 Dígitos)"}),e.jsx("input",{value:h,onChange:y,maxLength:25,className:"w-full h-14 px-5 rounded-2xl bg-white/[0.03] border border-white/10 text-[15px] text-amber-200 font-mono focus:outline-none focus:border-amber-500/50 focus:bg-white/[0.06] transition-all",placeholder:"AO06 0000 0000...",type:"text"})]})]}),e.jsxs("div",{className:"mt-12 space-y-4",children:[l==="edit"&&e.jsx("button",{onClick:()=>c("view"),className:"w-full h-10 text-gray-500 text-[11px] font-black uppercase tracking-widest hover:text-white transition-colors",children:"Cancelar Alterações"}),e.jsxs("button",{onClick:B,disabled:f,className:"relative group w-full h-16 overflow-hidden rounded-2xl",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-600 to-amber-400 group-hover:scale-105 transition-transform duration-500"}),e.jsx("div",{className:"relative flex items-center justify-center font-black text-black text-sm uppercase tracking-[0.2em]",children:f?e.jsx(A,{size:"w-6 h-6",className:"text-black"}):l==="edit"?"Salvar Novo Cartão":"Vincular Minha Conta"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 opacity-30 pt-2",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"shield"}),e.jsx("p",{className:"text-[9px] uppercase font-bold tracking-tighter",children:"Dados guardados sob criptografia militar"})]})]})]})})]})};export{I as default};
