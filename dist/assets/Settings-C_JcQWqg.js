import{r as n,u as N,j as e,s as g,S as z}from"./index-BauRbZeW.js";const _=({onBack:d})=>{const[a,r]=n.useState(""),[o,p]=n.useState(""),[b,x]=n.useState(""),{showLoading:c,hideLoading:h,showToast:t}=N(),m=async l=>{if(l.preventDefault(),o!==b){t("As senhas não coincidem.","error");return}if(o.length<6){t("A nova senha deve ter pelo menos 6 caracteres.","error");return}c();try{const{error:u}=await g.auth.updateUser({password:o});if(u)throw u;t("Senha de login atualizada com sucesso!","success"),d()}catch(u){console.error("Error updating password:",u),t(u.message||"Erro ao atualizar senha.","error")}finally{h()}};return e.jsxs("div",{className:"min-h-screen bg-[#F9FAFB] flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b border-gray-100 px-4 h-16 flex items-center justify-between sticky top-0 z-10",children:[e.jsx("button",{onClick:d,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-50 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-gray-600",children:"arrow_back"})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"Alterar Senha de Login"}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"p-4 max-w-md mx-auto w-full",children:[e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nova Senha"}),e.jsx("input",{type:"password",value:o,onChange:l=>p(l.target.value),className:"w-full h-12 px-4 rounded-xl border border-gray-200 focus:border-black focus:ring-0 transition-all",placeholder:"Mínimo 6 caracteres",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirmar Nova Senha"}),e.jsx("input",{type:"password",value:b,onChange:l=>x(l.target.value),className:"w-full h-12 px-4 rounded-xl border border-gray-200 focus:border-black focus:ring-0 transition-all",placeholder:"Repita a nova senha",required:!0})]})]}),e.jsx("button",{type:"submit",className:"w-full h-12 bg-black text-white rounded-xl font-bold hover:bg-gray-800 transition-all shadow-lg active:scale-95",children:"Atualizar Senha"})]}),e.jsx("div",{className:"mt-6 p-4 bg-yellow-50 rounded-xl border border-yellow-100",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-yellow-600 text-xl font-variation-icon-fill",children:"info"}),e.jsx("p",{className:"text-sm text-yellow-800 leading-relaxed",children:"Dica: Use uma senha forte com letras e números. Após a alteração, você poderá usar a nova senha em seu próximo login."})]})})]})]})},I=({onBack:d})=>{const[a,r]=n.useState(""),[o,p]=n.useState(""),{showLoading:b,hideLoading:x,showToast:c}=N(),h=async t=>{if(t.preventDefault(),a!==o){c("Os PINs não coincidem.","error");return}if(!/^\d{4}$/.test(a)){c("O PIN deve ter exatamente 4 dígitos numéricos.","error");return}b();try{const{data:m,error:l}=await g.rpc("update_withdrawal_pin",{p_new_pin:a});if(l)throw l;c("PIN de retirada atualizado com sucesso!","success"),d()}catch(m){console.error("Error updating PIN:",m),c(m.message||"Erro ao atualizar PIN.","error")}finally{x()}};return e.jsxs("div",{className:"min-h-screen bg-[#F9FAFB] flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b border-gray-100 px-4 h-16 flex items-center justify-between sticky top-0 z-10",children:[e.jsx("button",{onClick:d,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-50 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-gray-600",children:"arrow_back"})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"Alterar PIN de Retirada"}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"p-4 max-w-md mx-auto w-full",children:[e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Novo PIN (4 dígitos)"}),e.jsx("input",{type:"text",inputMode:"numeric",maxLength:4,value:a,onChange:t=>r(t.target.value.replace(/\D/g,"")),className:"w-full h-12 px-4 rounded-xl border border-gray-200 focus:border-black focus:ring-0 transition-all text-center text-2xl tracking-[0.5em] font-bold",placeholder:"****",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirmar Novo PIN"}),e.jsx("input",{type:"text",inputMode:"numeric",maxLength:4,value:o,onChange:t=>p(t.target.value.replace(/\D/g,"")),className:"w-full h-12 px-4 rounded-xl border border-gray-200 focus:border-black focus:ring-0 transition-all text-center text-2xl tracking-[0.5em] font-bold",placeholder:"****",required:!0})]})]}),e.jsx("button",{type:"submit",className:"w-full h-12 bg-black text-white rounded-xl font-bold hover:bg-gray-800 transition-all shadow-lg active:scale-95",children:"Atualizar PIN"})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-xl border border-blue-100",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-blue-600 text-xl font-variation-icon-fill",children:"security"}),e.jsx("p",{className:"text-sm text-blue-800 leading-relaxed",children:"Importante: Este PIN será solicitado em todas as suas solicitações de retirada. Não compartilhe com ninguém."})]})})]})]})},L=({onNavigate:d,showToast:a,profile:r})=>{const{withLoading:o,showLoading:p,hideLoading:b}=N(),[x,c]=n.useState((r==null?void 0:r.full_name)||""),[h,t]=n.useState((r==null?void 0:r.avatar_url)||""),[m,l]=n.useState(!1),[u,y]=n.useState("main"),j=n.useRef(null);n.useEffect(()=>{r&&(c(r.full_name||""),t(r.avatar_url||""))},[r]);const S=async s=>{var v;const i=(v=s.target.files)==null?void 0:v[0];if(i){if(!i.type.startsWith("image/")){a==null||a("Por favor, selecione uma imagem válida.","error");return}if(i.size>2*1024*1024){a==null||a("A imagem deve ter no máximo 2MB.","error");return}p();try{const{data:{user:f}}=await g.auth.getUser();if(!f)throw new Error("Usuário não autenticado");const A=i.name.split(".").pop(),w=`${f.id}/${Date.now()}.${A}`,{error:k}=await g.storage.from("avatars").upload(w,i,{upsert:!0});if(k)throw k;const{data:{publicUrl:E}}=g.storage.from("avatars").getPublicUrl(w);t(E),a==null||a("Avatar carregado com sucesso!","success")}catch(f){console.error("Error uploading avatar:",f),a==null||a(f.message||"Erro ao carregar avatar.","error")}finally{b()}}},P=async()=>{if(!x.trim()){a==null||a("O nome completo não pode estar vazio.","warning");return}l(!0);try{await o(async()=>{const{data:{user:s}}=await g.auth.getUser();if(!s)throw new Error("Usuário não autenticado");const{error:i}=await g.from("profiles").update({full_name:x,avatar_url:h}).eq("id",s.id);if(i)throw i},"Configurações atualizadas com sucesso!"),d("profile")}catch(s){a==null||a(s.message||"Erro ao salvar configurações.","error")}finally{l(!1)}},C=["https://lh3.googleusercontent.com/aida-public/AB6AXuC_O5s3g5eF50cs5tQ_zh2NLwLYFyqEHtdcmZQASWBXJmsfG9k1wREC0IVW-eylYq2qw9Wumxb3YSS9L8wyFWSAANAxg0weMoxNXY5GHUshMgmu4w9sjeIyoflSKaECFCwFS1gStIJMDr7wVpnTKZtIpcTAH9dvh6Gana_Pw0-htT1Q9DdTGiPGHpfWu0oZKbmwz9Siq4VzRFUsXmwkyVAA2EOn-fhlHOMblENj8rod3pTqjUbUouxH6s1qZ6ZAEvzMM3z9YeCoHvE0"];return u==="password"?e.jsx(_,{onBack:()=>y("main")}):u==="pin"?e.jsx(I,{onBack:()=>y("main")}):e.jsxs("div",{className:"flex flex-col min-h-screen bg-background-dark font-display text-black antialiased",children:[e.jsxs("header",{className:"sticky top-0 z-50 flex items-center bg-background-dark/95 backdrop-blur-md p-4 pb-2 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>d("profile"),className:"text-primary flex size-12 shrink-0 items-center justify-start hover:bg-white/5 rounded-full transition-all active:scale-95",children:e.jsx("span",{className:"material-symbols-outlined text-[24px]",children:"arrow_back"})}),e.jsx("h2",{className:"text-black text-lg font-bold leading-tight tracking-tight flex-1 text-center pr-12",children:"Configurações"})]}),e.jsxs("main",{className:"flex-1 flex flex-col px-6 pt-8 pb-32 space-y-8",children:[e.jsxs("section",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative mb-4 cursor-pointer group",onClick:()=>{var s;return(s=j.current)==null?void 0:s.click()},children:[e.jsx("div",{className:"size-24 rounded-full border-4 border-[#f4c025] shadow-lg bg-center bg-cover bg-no-repeat overflow-hidden transition-transform group-hover:scale-105",style:{backgroundImage:`url("${h||C[0]}")`}}),e.jsx("div",{className:"absolute bottom-0 right-0 bg-primary text-black size-8 rounded-full flex items-center justify-center shadow-md border-2 border-white group-hover:bg-primary/90",children:e.jsx("span",{className:"material-symbols-outlined text-[18px]",children:"photo_camera"})}),e.jsx("input",{type:"file",ref:j,onChange:S,className:"hidden",accept:"image/*"})]}),e.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest",children:"Avatar do Perfil"})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[11px] font-black uppercase tracking-widest text-gray-500 ml-1",children:"Nome Completo"}),e.jsxs("div",{className:"relative flex items-center bg-white rounded-2xl border border-gray-200 p-4 focus-within:border-primary transition-all shadow-sm",children:[e.jsx("span",{className:"material-symbols-outlined text-primary mr-3",children:"person"}),e.jsx("input",{type:"text",value:x,onChange:s=>c(s.target.value),placeholder:"Seu nome completo",className:"w-full bg-transparent border-none p-0 text-sm font-bold text-black placeholder:text-gray-300 focus:ring-0"})]})]}),e.jsxs("div",{className:"space-y-2 opacity-60",children:[e.jsx("label",{className:"text-[11px] font-black uppercase tracking-widest text-gray-500 ml-1",children:"Telefone (Não editável)"}),e.jsxs("div",{className:"relative flex items-center bg-gray-50 rounded-2xl border border-gray-100 p-4 shadow-inner",children:[e.jsx("span",{className:"material-symbols-outlined text-gray-400 mr-3",children:"phone"}),e.jsx("input",{type:"text",value:(r==null?void 0:r.phone)||"",disabled:!0,className:"w-full bg-transparent border-none p-0 text-sm font-bold text-gray-400 focus:ring-0"})]})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-[11px] font-black uppercase tracking-widest text-gray-500 ml-1",children:"Segurança e Acesso"}),e.jsx("div",{className:"bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm",children:[{label:"Alterar Senha de Login",action:()=>y("password"),icon:"lock_reset"},{label:"Senha de Retirada",action:()=>y("pin"),icon:"pin"}].map((s,i,v)=>e.jsxs("button",{onClick:s.action,className:`w-full flex items-center justify-between p-4 active:bg-gray-50 transition-colors ${i!==v.length-1?"border-b border-gray-100":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-primary",children:s.icon}),e.jsx("span",{className:"text-sm font-bold",children:s.label})]}),e.jsx("span",{className:"material-symbols-outlined text-gray-300",children:"chevron_right"})]},s.label))})]}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{onClick:P,disabled:m,className:"w-full h-14 bg-black text-white rounded-2xl font-black text-sm uppercase tracking-[0.2em] shadow-xl active:scale-95 transition-all flex items-center justify-center gap-2 hover:bg-gray-900",children:m?e.jsx(z,{size:"w-5 h-5",className:"text-white"}):"Salvar Alterações"})})]})]})};export{L as default};
