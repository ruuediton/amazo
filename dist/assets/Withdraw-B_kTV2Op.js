import{u as E,r as c,s as b,j as e,S as u}from"./index-BauRbZeW.js";const F=({onNavigate:n,showToast:a})=>{var k;const{withLoading:L}=E(),[l,p]=c.useState(""),[N,f]=c.useState(!1),[t,v]=c.useState(null),[y,o]=c.useState(!1),[x,m]=c.useState(""),[d,g]=c.useState(!1),w=[5e3,1e4,2e4,5e4],S=.12;c.useEffect(()=>{h()},[]);const h=async()=>{f(!0);try{const{data:{user:r}}=await b.auth.getUser();if(!r){n("login");return}const{data:i,error:s}=await b.rpc("get_withdrawal_screen_data");if(s)throw console.error("RPC Error:",s),s;v(i)}catch(r){console.error("Fetch Error:",r),a==null||a("Erro ao carregar dados. Verifique sua conexão.","error")}finally{f(!1)}},_=async()=>{if(!t){a==null||a("Aguarde o carregamento...","info"),h();return}const r=new Date,i=new Date(r.toLocaleString("en-US",{timeZone:"Africa/Luanda"})).getHours();if(i<9||i>=14){a==null||a("Retiradas disponíveis das 09h às 14h (Angola).","error");return}if(!(t!=null&&t.has_bank_account)){a==null||a("Vincule uma conta bancária primeiro.","warning"),n("add-bank");return}if(t!=null&&t.has_pending_withdrawal){a==null||a("Você já possui uma retirada em processamento.","error");return}if(t!=null&&t.is_blocked){a==null||a("Conta temporariamente bloqueada.","error");return}const s=parseFloat(l);if(!l||isNaN(s)){a==null||a("Insira um valor válido.","warning");return}if(s<300){a==null||a("Mínimo: 300 Kz.","warning");return}if(s>t.balance){a==null||a("Saldo insuficiente.","error");return}o(!0)},C=async()=>{if(x.length===4){g(!0);try{const{data:r,error:i}=await b.rpc("request_withdrawal",{p_amount:parseFloat(l),p_pin:x});if(i)throw i;a==null||a("Retirada solicitada com sucesso!","success"),o(!1),m(""),setTimeout(()=>n("withdrawal-history"),1e3)}catch(r){a==null||a(r.message||"Erro ao processar retirada.","error"),m("")}finally{g(!1)}}},j=l?parseFloat(l)*S:0,z=l?parseFloat(l)-j:0;return N&&!t?e.jsx("div",{className:"bg-background-dark min-h-screen flex items-center justify-center",children:e.jsx(u,{size:"w-8 h-8"})}):e.jsxs("div",{className:"bg-[#0a0a0b] font-display text-white antialiased min-h-screen flex flex-col selection:bg-amber-500/30 pb-24",children:[e.jsxs("header",{className:"sticky top-0 z-50 flex items-center justify-between bg-[#0a0a0b]/80 px-6 py-4 backdrop-blur-xl border-b border-white/5",children:[e.jsx("button",{onClick:()=>n("profile"),className:"group flex items-center justify-center w-10 h-10 rounded-full bg-white/5 hover:bg-white/10 active:scale-90 transition-all border border-white/10",children:e.jsx("span",{className:"material-symbols-outlined text-amber-500 text-[22px] group-hover:-translate-x-0.5 transition-transform",children:"arrow_back"})}),e.jsx("h1",{className:"flex-1 text-center text-[15px] font-black uppercase tracking-[0.1em] text-white pr-10",children:"Retirar kwanza"})]}),e.jsxs("main",{className:"flex-1 flex flex-col px-6 pt-8 animate-in fade-in slide-in-from-bottom-8 duration-700",children:[e.jsxs("div",{className:"relative mb-10 group",children:[e.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-amber-500/20 to-amber-200/20 blur-2xl opacity-50 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative bg-white/[0.03] backdrop-blur-2xl p-6 rounded-[32px] border border-white/10 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"material-symbols-outlined text-amber-500 text-[18px]",children:"account_balance_wallet"}),e.jsx("p",{className:"text-gray-400 text-[11px] font-black uppercase tracking-widest",children:"Saldo para Retirada"})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-amber-500",children:"Kz"}),e.jsx("h2",{className:"text-4xl font-black text-white tracking-tighter",children:((k=t==null?void 0:t.balance)==null?void 0:k.toLocaleString())||"0,00"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2 group",children:[e.jsx("label",{className:"block text-[11px] font-black text-gray-500 ml-1 uppercase tracking-widest group-focus-within:text-amber-500 transition-colors",children:"Quantia Desejada"}),e.jsxs("div",{className:"relative flex items-center bg-white/[0.03] rounded-2xl border border-white/10 h-16 px-5 focus-within:border-amber-500/50 transition-all",children:[e.jsx("span",{className:"text-xl font-bold text-amber-500 mr-3",children:"Kz"}),e.jsx("input",{type:"number",value:l,onChange:r=>p(r.target.value),placeholder:"Introduza o valor",className:"w-full bg-transparent border-none p-0 text-[18px] font-bold text-white placeholder:text-gray-700 focus:ring-0"})]}),e.jsxs("div",{className:"flex justify-between items-center px-2 pt-1 border-t border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 grayscale",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"analytics"}),e.jsxs("span",{className:"text-[10px] text-gray-500 font-bold uppercase tracking-tight",children:["Taxa 12%: Kz ",j.toLocaleString()]})]}),e.jsx("div",{className:"flex items-center gap-1.5 font-black text-amber-500",children:e.jsxs("span",{className:"text-[10px] uppercase tracking-wide",children:["Líquido: Kz ",z.toLocaleString()]})})]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:w.map(r=>e.jsx("button",{onClick:()=>p(r.toString()),className:"h-11 rounded-xl bg-white/5 border border-white/5 flex items-center justify-center text-[12px] font-bold hover:bg-amber-500 hover:text-black hover:border-amber-500 active:scale-95 transition-all shadow-sm",children:r>=1e3?`${r/1e3}k`:r},r))}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("label",{className:"text-[11px] font-black text-gray-500 uppercase tracking-widest",children:"Canal de Destino"}),e.jsx("button",{onClick:()=>n("add-bank"),className:"text-[11px] font-black text-amber-500 uppercase",children:"Alterar"})]}),t!=null&&t.has_bank_account?e.jsxs("div",{className:"bg-gradient-to-br from-white/[0.05] to-transparent border border-white/10 rounded-2xl p-4 flex items-center gap-4 group hover:bg-white/[0.08] transition-colors cursor-pointer",onClick:()=>n("add-bank"),children:[e.jsx("div",{className:"size-12 rounded-2xl bg-amber-500 flex items-center justify-center shrink-0 shadow-lg shadow-amber-500/20",children:e.jsx("span",{className:"material-symbols-outlined text-black text-[28px]",children:"payments"})}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("p",{className:"text-[15px] font-black text-white truncate",children:t.bank_name}),e.jsx("p",{className:"text-[11px] text-gray-500 font-mono tracking-wider",children:t.masked_iban})]}),e.jsx("span",{className:"material-symbols-outlined text-amber-500 ml-auto animate-pulse",children:"check_circle"})]}):e.jsxs("button",{onClick:()=>n("add-bank"),className:"w-full bg-white/5 border border-dashed border-white/20 rounded-2xl p-6 flex flex-col items-center gap-2 hover:bg-white/10 transition-all",children:[e.jsx("div",{className:"size-10 rounded-full bg-gray-900 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-gray-500",children:"add_task"})}),e.jsx("p",{className:"text-[11px] font-black text-white uppercase tracking-widest",children:"Ativar Conta Bancária"})]})]})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-[#0a0a0b] via-[#0a0a0b]/90 to-transparent",children:e.jsxs("button",{onClick:_,disabled:d,className:"relative group w-full h-16 overflow-hidden rounded-2xl shadow-2xl shadow-amber-500/10",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-600 to-amber-400 group-hover:scale-105 transition-transform duration-500"}),e.jsx("div",{className:"relative flex items-center justify-center font-black text-black text-sm uppercase tracking-[0.2em]",children:d?e.jsx(u,{size:"w-6 h-6",className:"text-black"}):"Solicitar Saque"})]})}),y&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end justify-center px-4 pb-10",children:[e.jsx("div",{className:"absolute inset-0 bg-[#0a0a0b]/95 backdrop-blur-md",onClick:()=>!d&&o(!1)}),e.jsxs("div",{className:"relative w-full max-w-sm bg-[#121214] border border-white/10 rounded-[40px] p-8 shadow-2xl animate-in slide-in-from-bottom-20 duration-500",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsx("div",{className:"size-16 bg-amber-500/10 rounded-full flex items-center justify-center mb-4 border border-amber-500/20",children:e.jsx("span",{className:"material-symbols-outlined text-amber-500 text-[32px]",children:"dialpad"})}),e.jsx("h2",{className:"text-xl font-black text-white mb-1",children:"PIN Operacional"}),e.jsx("p",{className:"text-[10px] text-gray-500 font-black uppercase tracking-[0.2em]",children:"Criptografia de 256 bits"})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("input",{type:"password",value:x,onChange:r=>{const i=r.target.value.replace(/\D/g,"");i.length<=4&&m(i)},placeholder:"0000",autoFocus:!0,maxLength:4,className:"w-full bg-white/[0.03] border border-white/10 rounded-2xl h-16 text-center text-4xl font-black text-amber-500 tracking-[0.5em] focus:border-amber-500/50 focus:ring-0 transition-all placeholder:text-gray-800"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{disabled:d,onClick:()=>o(!1),className:"flex-1 h-14 bg-white/5 text-gray-400 font-black text-[12px] uppercase tracking-widest rounded-2xl border border-white/5 active:scale-95 transition-all",children:"Cancelar"}),e.jsx("button",{disabled:d||x.length<4,onClick:C,className:"flex-1 h-14 bg-white text-black font-black text-[12px] uppercase tracking-widest rounded-2xl active:scale-95 transition-all disabled:opacity-30",children:d?e.jsx(u,{size:"w-5 h-5"}):"Confirmar"})]})]})]})]})]})};export{F as default};
