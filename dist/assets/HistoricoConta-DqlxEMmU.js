import{r as o,s as y,j as t,S as U}from"./index-BauRbZeW.js";import{E as Y}from"./jspdf.es.min-DwE3tdNP.js";const x=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],J=({onNavigate:T})=>{const[$,g]=o.useState(!1),[b,C]=o.useState(new Date().getMonth()),[m,A]=o.useState("Todos"),[h,F]=o.useState(new Date().getFullYear()),[i,_]=o.useState("Misto"),[f,G]=o.useState("Dia Inteiro"),[j,w]=o.useState(!1),[k,S]=o.useState(0),[d,E]=o.useState(null),[O,M]=o.useState([]),[z,D]=o.useState(!0);o.useEffect(()=>{L()},[]);const L=async()=>{var e;D(!0);try{const{data:{user:a}}=await y.auth.getUser();if(!a)return;const{data:c}=await y.from("profiles").select("code").eq("user_id",a.id).single();E({code:(c==null?void 0:c.code)||"N/A",phone:a.phone||((e=a.user_metadata)==null?void 0:e.phone)||"N/A"});const{data:p}=await y.from("deposits").select("*").eq("user_id",a.id),{data:u}=await y.from("withdrawals").select("*").eq("user_id",a.id),{data:n}=await y.from("historico_compra").select("*").eq("uid_user",a.id),l=[];p==null||p.forEach(s=>{const r=new Date(s.created_at);l.push({id:`dep-${s.id}`,title:"Depósito de Saldo",subtitle:`${s.nome_banco||s.method} - ${s.status_playment||"Pendente"}`,amount:Number(s.amount),time:r.toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"}),dateLabel:`${r.getDate()} de ${x[r.getMonth()]}`,monthIndex:r.getMonth(),year:r.getFullYear(),type:"incoming",category:"Depósito",status:s.status_playment})}),u==null||u.forEach(s=>{const r=s.created_at?new Date(s.created_at):new Date;l.push({id:`wit-${s.id}`,title:"Levantamento de Fundos",subtitle:`${s.nome_banco} - ${s.status}`,amount:-Number(s.amount_original),time:r.toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"}),dateLabel:`${r.getDate()} de ${x[r.getMonth()]}`,monthIndex:r.getMonth(),year:r.getFullYear(),type:"outgoing",category:"Retirada",status:s.status})}),n==null||n.forEach(s=>{const r=new Date(s.created_at);l.push({id:`pur-${s.id}`,title:s.nome||"Compra de Pacote",subtitle:"Investimento amazon",amount:-Number(s.preco_unitario),time:r.toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"}),dateLabel:`${r.getDate()} de ${x[r.getMonth()]}`,monthIndex:r.getMonth(),year:r.getFullYear(),type:"outgoing",category:"Compras"})}),M(l.sort((s,r)=>r.id.localeCompare(s.id)))}catch(a){console.error("Erro ao buscar histórico real:",a)}finally{D(!1)}},N=O.filter(e=>{const a=e.monthIndex===b,c=e.year===h,p=i==="Misto"||e.category===i,u=parseInt(e.dateLabel.split(" ")[0]),n=m==="Todos"||u===m,l=parseInt(e.time.split(":")[0]);let s=!0;return f==="Manhã (06-12)"&&(s=l>=6&&l<12),f==="Tarde (12-18)"&&(s=l>=12&&l<18),f==="Noite (18-00)"&&(s=l>=18||l<6),a&&c&&p&&n&&s}),v=N.reduce((e,a)=>{const c=a.dateLabel;return e[c]||(e[c]=[]),e[c].push(a),e},{}),R=()=>{const e=new Y,a=new Date,c=a.toLocaleDateString("pt-PT"),p=a.toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"});e.setFillColor(24,23,17),e.rect(0,0,210,50,"F"),e.setFillColor(255,153,0),e.rect(0,48,210,2,"F"),e.setTextColor(255,255,255),e.setFontSize(24),e.setFont("helvetica","bold"),e.text("EXTRATO AMAZON",105,18,{align:"center"}),e.setFontSize(10),e.text(`ID: ${d==null?void 0:d.code}`,105,28,{align:"center"}),e.text(`TELEFONE: ${d==null?void 0:d.phone}`,105,34,{align:"center"}),e.setFontSize(9),e.setTextColor(180,180,180);const u=`MÊS: ${x[b].toUpperCase()} | DIA: ${m} | ANO: ${h} | PERÍODO: ${f.toUpperCase()}`;e.text(`${u}`,105,40,{align:"center"}),e.text(`TIPO: ${i.toUpperCase()} | GERADO EM: ${c} ÀS ${p}`,105,45,{align:"center"});let n=65;e.setTextColor(0,0,0),e.setFontSize(10),e.setFillColor(245,245,245),e.rect(10,n-6,190,10,"F"),e.setFont("helvetica","bold"),e.text("DATA / HORA",15,n),e.text("DESCRIÇÃO DA OPERAÇÃO",60,n),e.text("VALOR (KZ)",165,n),n+=12,N.forEach(l=>{n>275&&(e.addPage(),n=25);const s=l.type==="incoming";e.setFont("helvetica","normal"),e.setFontSize(9),e.setTextColor(100,100,100);const r=l.dateLabel.split(" de ")[0],P=(x.indexOf(l.dateLabel.split(" de ")[1])+1).toString().padStart(2,"0");e.text(`${r}/${P}/${l.year}`,15,n),e.text(l.time,15,n+4),e.setFont("helvetica","bold"),e.setTextColor(0,0,0),e.text(l.title.toUpperCase(),60,n),e.setFont("helvetica","normal"),e.setFontSize(8),e.setTextColor(120,120,120),e.text(l.subtitle,60,n+4),e.setFontSize(10),e.setFont("helvetica","bold"),s?(e.setTextColor(0,120,0),e.text(`+ ${l.amount.toLocaleString("pt-AO")}`,165,n+2)):(e.setTextColor(200,0,0),e.text(`- ${Math.abs(l.amount).toLocaleString("pt-AO")}`,165,n+2)),n+=14,e.setDrawColor(240,240,240),e.line(10,n-9,200,n-9)}),e.setFontSize(8),e.setTextColor(180,180,180),e.text("© Amazon Angola Financial System - Este é um documento gerado eletronicamente.",105,290,{align:"center"}),e.save(`Extrato_Amazon_${d==null?void 0:d.code}_${x[b]}_${h}.pdf`)},I=()=>{if(N.length===0){alert(`O extrato de ${i} para o período selecionado não possui registros.`);return}g(!1),w(!0),S(0)};return o.useEffect(()=>{if(j){const e=setInterval(()=>{S(a=>a>=100?(clearInterval(e),setTimeout(()=>{R(),w(!1)},600),100):a+5)},50);return()=>clearInterval(e)}},[j,i,b,m,h,f]),t.jsxs("div",{className:"bg-background-dark font-display text-black antialiased min-h-screen flex flex-col",children:[t.jsxs("header",{className:"flex items-center p-4 justify-between bg-background-dark sticky top-0 z-40 border-b border-gray-200 backdrop-blur-md bg-opacity-90",children:[t.jsx("button",{onClick:()=>T("profile"),className:"size-10 flex items-center justify-center rounded-full hover:bg-white/10 transition-colors text-primary",children:t.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"})}),t.jsx("h2",{className:"text-lg font-bold flex-1 text-center pr-10 tracking-tight",children:"Histórico de Conta"})]}),t.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-surface-dark/30",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("p",{className:"text-[text-gray-400] text-[10px] font-black uppercase tracking-widest",children:"Exibindo"}),t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("p",{className:"text-black text-sm font-bold truncate max-w-[150px]",children:[i," - ",x[b].toUpperCase()]}),t.jsxs("p",{className:"text-primary text-[10px] font-bold",children:[m==="Todos"?"Mês Inteiro":`Dia ${m}`," | ",h," | ",f]})]})]}),t.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary text-black rounded-xl font-black text-xs shadow-lg shadow-primary/20 active:scale-95 transition-all",children:[t.jsx("span",{className:"material-symbols-outlined text-[18px]",children:"tune"}),"FILTROS"]})]}),t.jsx("main",{className:"flex-1 overflow-y-auto no-scrollbar pb-24 touch-pan-y",children:z?t.jsx("div",{className:"flex items-center justify-center py-20",children:t.jsx(U,{size:"w-8 h-8"})}):Object.keys(v).length>0?Object.keys(v).map(e=>t.jsxs("div",{className:"mb-6",children:[t.jsxs("p",{className:"text-[text-gray-400] text-[11px] font-black uppercase tracking-[0.2em] pb-3 pt-6 px-6 opacity-60 flex items-center gap-2",children:[t.jsx("span",{className:"size-1 bg-primary rounded-full"}),e]}),t.jsx("div",{className:"flex flex-col gap-1 px-3",children:v[e].map(a=>t.jsxs("div",{className:"group flex items-center gap-4 px-4 py-4 hover:bg-white/5 transition-colors rounded-[24px] border border-transparent hover:border-gray-200",children:[t.jsx("div",{className:`relative flex items-center justify-center size-12 rounded-2xl shrink-0 border border-gray-200 shadow-inner ${a.category==="Depósito"?"bg-green-500/10 text-green-600":a.category==="Retirada"?"bg-primary/10 text-primary":a.category==="Segurança"?"bg-blue-500/10 text-blue-400":"bg-white/5 text-gray-600"}`,children:t.jsx("span",{className:"material-symbols-outlined text-[24px]",children:a.category==="Depósito"?"add_card":a.category==="Retirada"?"payments":a.category==="Segurança"?"security":"shopping_bag"})}),t.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[t.jsxs("div",{className:"flex justify-between items-baseline",children:[t.jsx("p",{className:"text-black text-[15px] font-bold truncate leading-tight",children:a.title}),a.amount!==0&&t.jsxs("p",{className:`text-[15px] font-black ${a.type==="incoming"?"text-green-600":"text-black"}`,children:[a.amount>0?"+":""," Kz ",Math.abs(a.amount).toLocaleString()]})]}),t.jsxs("div",{className:"flex justify-between items-center mt-1",children:[t.jsx("p",{className:"text-[text-gray-400] text-[11px] uppercase font-bold tracking-wider opacity-70 truncate",children:a.subtitle}),t.jsx("p",{className:"text-[text-gray-400] text-[11px] font-medium",children:a.time})]})]})]},a.id))})]},e)):t.jsxs("div",{className:"flex flex-col items-center justify-center py-32 px-10 text-center opacity-30",children:[t.jsx("div",{className:"size-20 bg-surface-dark rounded-full flex items-center justify-center mb-6",children:t.jsx("span",{className:"material-symbols-outlined text-4xl",children:"folder_off"})}),t.jsx("p",{className:"font-black uppercase tracking-[0.2em] text-[12px] leading-relaxed",children:"Nenhum registro encontrado para este filtro"})]})}),$&&t.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center px-4 pb-12",children:[t.jsx("div",{className:"absolute inset-0 bg-black/90 backdrop-blur-md",onClick:()=>g(!1)}),t.jsxs("div",{className:"relative w-full max-w-sm bg-[#111] rounded-[40px] p-8 shadow-2xl border border-gray-200 animate-in fade-in slide-in-from-bottom-20 overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("h3",{className:"text-lg font-black text-black italic tracking-tighter uppercase flex items-center gap-2",children:[t.jsx("span",{className:"w-1.5 h-6 bg-primary rounded-full"}),"Filtrar Extrato"]}),t.jsx("button",{onClick:()=>g(!1),className:"text-gray-500 hover:text-black transition-colors",children:t.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),t.jsxs("div",{className:"relative h-56 flex items-center justify-between overflow-hidden bg-white/5 rounded-3xl border border-gray-200 px-2",children:[t.jsx("div",{className:"absolute inset-0 pointer-events-none flex items-center justify-center",children:t.jsxs("div",{className:"w-full h-12 bg-white/10 border-y border-white/10 relative",children:[t.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-primary"}),t.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 bg-primary"})]})}),t.jsx("div",{className:"flex-1 h-full overflow-y-auto no-scrollbar snap-y snap-mandatory py-[88px] text-center touch-pan-y",children:[2022,2023,2024,2025,2026,2027,2028,2029,2030].map(e=>t.jsx("button",{onClick:()=>F(e),className:`snap-center h-12 w-full flex items-center justify-center transition-all ${h===e?"text-black font-black text-lg":"text-gray-600 font-bold text-xs opacity-40"}`,children:e},e))}),t.jsx("div",{className:"flex-1 h-full overflow-y-auto no-scrollbar snap-y snap-mandatory py-[88px] text-center touch-pan-y",children:["Todos",...Array.from({length:31},(e,a)=>a+1)].map(e=>t.jsx("button",{onClick:()=>A(e),className:`snap-center h-12 w-full flex items-center justify-center transition-all ${m===e?"text-black font-black text-lg":"text-gray-600 font-bold text-xs opacity-40"}`,children:e==="Todos"?"ALL":e},e))}),t.jsx("div",{className:"flex-1 h-full overflow-y-auto no-scrollbar snap-y snap-mandatory py-[88px] text-center touch-pan-y",children:x.map((e,a)=>t.jsx("button",{onClick:()=>C(a),className:`snap-center h-12 w-full flex items-center justify-center transition-all ${b===a?"text-black font-black text-lg":"text-gray-600 font-bold text-xs opacity-40"}`,children:e.toLowerCase()},e))}),t.jsx("div",{className:"flex-[1.5] h-full overflow-y-auto no-scrollbar snap-y snap-mandatory py-[88px] text-center touch-pan-y",children:["Misto","Depósito","Retirada","Segurança"].map(e=>t.jsx("button",{onClick:()=>_(e),className:`snap-center h-12 w-full flex items-center justify-center transition-all px-1 ${i===e?"text-primary font-black text-sm uppercase scale-110":"text-gray-600 font-bold text-[10px] opacity-40 lowercase"}`,children:e==="Segurança"?"seg":e},e))})]}),t.jsxs("div",{className:"mt-8 flex gap-3",children:[t.jsxs("button",{onClick:I,className:"flex-[2] h-14 bg-primary text-black rounded-2xl flex items-center justify-center gap-3 font-black shadow-xl shadow-primary/20 active:scale-95 transition-all text-xs tracking-widest uppercase",children:[t.jsx("span",{className:"material-symbols-outlined text-xl",children:"picture_as_pdf"}),"Baixar PDF"]}),t.jsx("button",{onClick:()=>g(!1),className:"flex-1 h-14 bg-white/5 text-black rounded-2xl flex items-center justify-center font-black active:scale-95 transition-all text-xs uppercase",children:"Aplicar"})]})]})]}),j&&t.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center px-8",children:[t.jsx("div",{className:"absolute inset-0 bg-background-dark/95 backdrop-blur-xl"}),t.jsxs("div",{className:"relative w-full max-w-xs flex flex-col items-center text-center",children:[t.jsxs("div",{className:`w-32 h-40 rounded-lg mb-8 relative transition-transform animate-pulse shadow-2xl ${i==="Depósito"?"bg-green-600":i==="Retirada"?"bg-yellow-600":i==="Segurança"?"bg-blue-600":"bg-primary"}`,children:[t.jsxs("div",{className:"absolute inset-0 flex flex-col p-3 text-black overflow-hidden opacity-50",children:[t.jsxs("p",{className:"text-[8px] font-black mb-1",children:["AMAZON EXT. ",i.toUpperCase()]}),t.jsx("div",{className:"w-full h-1 bg-white/20 mb-1 rounded"}),t.jsx("div",{className:"w-2/3 h-1 bg-white/20 mb-3 rounded"}),t.jsx("div",{className:"space-y-1",children:[1,2,3,4,5].map(e=>t.jsx("div",{className:"w-full h-0.5 bg-white/10 rounded"},e))})]}),t.jsx("div",{className:"absolute right-2 bottom-2",children:t.jsx("span",{className:"material-symbols-outlined text-black text-2xl",children:"verified_user"})})]}),t.jsx("h2",{className:"text-2xl font-black text-black mb-2 leading-tight",children:"Gerando Extrato..."}),t.jsx("p",{className:"text-gray-500 text-sm font-bold uppercase tracking-widest mb-8",children:"Amazon Angola Sytem"}),t.jsx("div",{className:"w-full h-2 bg-white/5 rounded-full overflow-hidden mb-4 border border-gray-200 ring-4 ring-white/5",children:t.jsx("div",{className:`h-full transition-all duration-100 ease-linear ${i==="Depósito"?"bg-green-400":i==="Retirada"?"bg-primary":i==="Segurança"?"bg-blue-400":"bg-primary"}`,style:{width:`${k}%`}})}),t.jsxs("div",{className:"flex items-baseline gap-1",children:[t.jsx("span",{className:"text-black text-4xl font-black tracking-tighter",children:k}),t.jsx("span",{className:"text-primary text-xl font-black",children:"%"})]}),t.jsxs("p",{className:"mt-8 text-gray-500 text-[10px] font-black uppercase tracking-[0.3em] flex items-center gap-3",children:[t.jsx("span",{className:"size-1.5 bg-green-500 rounded-full animate-ping"}),"PROCESSANDO DADOS SEGUROS"]})]})]})]})};export{J as default};
