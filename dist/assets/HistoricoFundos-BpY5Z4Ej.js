import{r as c,R as m,j as e,S as z,s as u}from"./index-BauRbZeW.js";import{E as C}from"./jspdf.es.min-DwE3tdNP.js";const E=({onNavigate:p,showToast:n})=>{const[d,b]=c.useState([]),[j,f]=c.useState(!0),[g,y]=c.useState({totalApplied:0,totalProfit:0});c.useEffect(()=>{(async()=>{f(!0);try{await Promise.all([N(),k()])}catch(t){console.error("Initialization error:",t)}finally{f(!1)}})()},[]);const N=async()=>{try{await u.rpc("process_matured_investments")}catch(a){console.error("Error finalizing funds:",a)}},k=async()=>{try{const{data:{user:a}}=await u.auth.getUser();if(!a)return;const{data:t,error:s}=await u.from("usuario_fundos").select("*, fund:fundos(nome_fundo, taxa_retorno, url_imagem)").eq("id_usuario",a.id).order("data_inicio",{ascending:!1});if(s)throw s;const r=t||[];b(r);const i=r.reduce((o,l)=>o+Number(l.valor_aplicado),0),x=r.reduce((o,l)=>l.estado_ativo?o:o+(Number(l.retorno_calculado)-Number(l.valor_aplicado)),0);y({totalApplied:i,totalProfit:x})}catch(a){console.error("Error fetching investments:",a),n&&n("Erro ao carregar seu histórico.","error")}},v=m.useCallback((a,t)=>{const s=new Date(a).getTime(),r=new Date(t).getTime(),i=new Date().getTime();if(i>=r)return 100;const x=r-s,o=i-s,l=Math.round(o/x*100);return Math.max(0,Math.min(100,l))},[]),w=m.useCallback((a,t)=>a?t>=100?"Aguardando Liquidação":t>=80?"Próximo do Término":"Em Crescimento":"Finalizado",[]),h=m.useCallback(a=>new Date(a).toLocaleDateString("pt-AO",{day:"2-digit",month:"short",year:"numeric"}),[]),_=a=>{var s;const t=new C({orientation:"landscape",unit:"mm",format:"a5"});t.setFillColor(255,255,255),t.rect(0,0,210,148,"F"),t.setLineWidth(1),t.setDrawColor(244,209,37),t.rect(5,5,200,138),t.setFont("helvetica","bold"),t.setFontSize(22),t.setTextColor(20,20,20),t.text("CERTIFICADO DE INVESTIMENTO",105,25,{align:"center"}),t.setFontSize(10),t.setTextColor(100,100,100),t.text("AMAZON WEALTH MANAGEMENT",105,32,{align:"center"}),t.setDrawColor(200,200,200),t.line(40,38,170,38),t.setFontSize(12),t.setTextColor(60,60,60),t.text("Certificamos que o investimento foi realizado com sucesso.",105,50,{align:"center"}),t.setFillColor(250,250,250),t.roundedRect(40,60,130,50,3,3,"F"),t.setFontSize(14),t.setTextColor(0,0,0),t.text(((s=a.fund)==null?void 0:s.nome_fundo)||"Fundo de Investimento",105,75,{align:"center"}),t.setFontSize(30),t.setTextColor(34,197,94),t.text(`Kz ${Number(a.valor_aplicado).toLocaleString("pt-AO")}`,105,90,{align:"center"}),t.setFontSize(10),t.setTextColor(100,100,100),t.text(`Data de Aplicação: ${h(a.data_inicio)}`,105,102,{align:"center"}),t.setFontSize(8),t.setTextColor(150,150,150),t.text(`ID do Contrato: ${a.id_usuario_fundo}`,105,130,{align:"center"}),t.text("Este documento é um comprovante digital válido.",105,135,{align:"center"}),t.save(`Certificado_Amazon_${a.id_usuario_fundo.slice(0,8)}.pdf`),n&&n("Certificado baixado com sucesso!","success")};return e.jsxs("div",{className:"bg-white text-gray-900 pb-32 font-display min-h-screen",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center p-4 pb-2 justify-between",children:[e.jsx("button",{onClick:()=>p("investimentos-fundo"),className:"text-primary flex size-12 shrink-0 items-center justify-start cursor-pointer hover:opacity-70 transition-opacity",children:e.jsx("span",{className:"material-symbols-outlined text-[24px]",children:"arrow_back"})}),e.jsx("h2",{className:"text-gray-900 text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-4",children:"Meus Contratos"}),e.jsx("div",{className:"flex w-12 items-center justify-end",children:e.jsx("button",{className:"flex size-12 cursor-pointer items-center justify-center rounded-lg bg-transparent text-gray-900 hover:bg-gray-100 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-2xl",children:"analytics"})})})]})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col items-stretch justify-start rounded-3xl bg-black border border-gray-800 p-6 relative overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"flex flex-col gap-1 z-10",children:[e.jsx("p",{className:"text-gray-400 text-[10px] font-black uppercase tracking-[0.2em]",children:"Volume Total Aplicado"}),e.jsxs("h1",{className:"text-white text-3xl font-black italic tabular-nums py-1",children:["Kz ",g.totalApplied.toLocaleString("pt-AO",{minimumFractionDigits:2})]}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsxs("div",{className:"flex items-center bg-primary text-black px-2 py-0.5 rounded-full text-[9px] font-black uppercase tracking-wider",children:[e.jsx("span",{className:"material-symbols-outlined text-xs mr-1",children:"trending_up"}),"Lucros Realizados: Kz ",g.totalProfit.toLocaleString("pt-AO")]})})]}),e.jsx("div",{className:"absolute right-[-20px] bottom-[-20px] opacity-20 pointer-events-none",children:e.jsx("span",{className:"material-symbols-outlined text-[140px] text-primary",children:"currency_exchange"})})]})}),e.jsxs("section",{className:"px-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsx("h2",{className:"text-black text-[18px] font-black tracking-tight",children:"Ativos em Carteira"}),e.jsxs("span",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest bg-gray-50 px-3 py-1 rounded-full",children:[d.length," Ativos"]})]}),j?e.jsx("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:e.jsx(z,{size:"w-10 h-10"})}):e.jsx("div",{className:"flex flex-col gap-5 mt-2",children:d.length>0?d.map(a=>{var r,i;const t=v(a.data_inicio,a.data_termino),s=!a.estado_ativo;return e.jsxs("div",{className:"flex flex-col bg-white border border-gray-100 rounded-3xl overflow-hidden shadow-sm hover:shadow-lg transition-all duration-300",children:[e.jsxs("div",{className:"p-5 flex gap-5",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"size-16 rounded-full flex items-center justify-center relative shadow-inner",style:{background:`radial-gradient(closest-side, white 82%, transparent 83% 100%), conic-gradient(${s?"#10b981":"#f4c025"} ${t}%, #f8fafc 0)`},children:(r=a.fund)!=null&&r.url_imagem?e.jsx("img",{src:a.fund.url_imagem,alt:a.fund.nome_fundo,className:"w-full h-full object-cover rounded-full"}):s?e.jsx("span",{className:"material-symbols-outlined text-green-600 text-3xl",children:"task_alt"}):e.jsxs("span",{className:"text-[13px] font-black text-black",children:[t,"%"]})})}),e.jsxs("div",{className:"flex-1 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-black font-black text-base leading-tight",children:((i=a.fund)==null?void 0:i.nome_fundo)||"Ativo Amazon"}),e.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[9px] font-black uppercase tracking-widest ${s?"bg-green-100 text-green-600":"bg-yellow-100 text-yellow-700"}`,children:[e.jsx("span",{className:"size-1.5 rounded-full bg-current animate-pulse"}),s?"Resgatado":"Operando"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-y-4 gap-x-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-[8px] uppercase font-black tracking-[0.15em] mb-1",children:"Capital Aplicado"}),e.jsxs("p",{className:"text-black font-black text-sm tabular-nums",children:["Kz ",Number(a.valor_aplicado).toLocaleString("pt-AO")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-gray-400 text-[8px] uppercase font-black tracking-[0.15em] mb-1",children:["Retorno ",s?"Final":"Estimado"]}),e.jsxs("p",{className:"text-green-600 font-black text-sm tabular-nums",children:["Kz ",Number(a.retorno_calculado).toLocaleString("pt-AO")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-[8px] uppercase font-black tracking-[0.15em] mb-1",children:"Data de Vencimento"}),e.jsx("p",{className:"text-black font-bold text-xs",children:h(a.data_termino)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-gray-400 text-[8px] uppercase font-black tracking-[0.15em] mb-1",children:"Status da Operação"}),e.jsx("p",{className:`${s?"text-green-600":"text-primary"} font-black text-[10px] uppercase tracking-tighter`,children:w(a.estado_ativo,t)})]})]})]})]}),e.jsxs("div",{className:`flex ${s?"justify-between":"justify-end"} items-center p-3 px-5 bg-gray-50/50 border-t border-gray-100`,children:[s&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-green-600 text-lg",children:"check_circle"}),e.jsx("span",{className:"text-gray-400 text-[10px] font-black uppercase tracking-widest",children:"Liquidado"})]}),e.jsx("button",{onClick:()=>{s?_(a):n&&n("Contrato em custódia até o vencimento.","info")},className:`px-8 h-9 rounded-xl text-[10px] font-black uppercase tracking-[0.15em] shadow-sm active:scale-95 transition-all ${s?"bg-gray-200 text-gray-700":"bg-primary text-black"}`,children:s?"Recibo / Certificado":"Gerenciar"})]})]},a.id_usuario_fundo)}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center opacity-40",children:[e.jsx("span",{className:"material-symbols-outlined text-6xl mb-4",children:"inventory_2"}),e.jsx("p",{className:"font-black text-xs uppercase tracking-widest",children:"Nenhuma operação ativa"})]})}),e.jsxs("div",{className:"mt-12 mb-10 p-10 rounded-[40px] bg-primary/5 border-2 border-dashed border-primary/20 flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"size-16 rounded-full bg-white flex items-center justify-center shadow-lg mb-4",children:e.jsx("span",{className:"material-symbols-outlined text-primary text-3xl",children:"add"})}),e.jsx("p",{className:"text-black font-black text-sm uppercase tracking-widest mb-2",children:"Novo Contrato"}),e.jsx("p",{className:"text-gray-500 text-[11px] font-medium max-w-[200px] mb-6",children:"Explore novos ativos e maximize seus rendimentos mensais."}),e.jsx("button",{onClick:()=>p("investimentos-fundo"),className:"bg-black text-white px-8 h-12 rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-xl hover:bg-gray-900 transition-all",children:"EXPLORAR MERCADO"})]})]})]})};export{E as default};
