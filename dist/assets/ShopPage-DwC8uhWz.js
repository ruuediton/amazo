import{u as F,r as i,s as r,j as e,S as y}from"./index-BauRbZeW.js";const P=({onNavigate:p,showToast:s,balance:c})=>{const{withLoading:f}=F(),[b,k]=i.useState([]),[w,h]=i.useState(!0),[a,d]=i.useState(null),[l,m]=i.useState(1),[o,g]=i.useState(!1);i.useEffect(()=>{j();const t=r.channel("products-realtime").on("postgres_changes",{event:"*",schema:"public",table:"products"},()=>{j()}).subscribe();return()=>{t.unsubscribe()}},[]);const j=async(t=!1)=>{t&&h(!0),await f(async()=>{const{data:n,error:x}=await r.from("products").select("*").eq("status","active").order("price",{ascending:!0});x?s==null||s("Tente novamente","error"):k(n||[])}),h(!1)},_=t=>{d(t),m(1)},C=async()=>{a&&await f(async()=>{g(!0);try{const{data:{user:t}}=await r.auth.getUser();if(!t){s==null||s("Sessão expirada. Faça login novamente.","error"),p("login");return}const{count:n,error:x}=await r.from("historico_compras").select("*",{count:"exact",head:!0}).eq("user_id",t.id).eq("nome_produto",a.name);if(x)throw x;const S=n||0,z=a.purchase_limit-S;if(l>z){s==null||s(`Limite atingido (${a.purchase_limit} unidades).`,"error");return}const q=a.price*l;if(c<q){s==null||s("Saldo insuficiente","error");return}for(let N=0;N<l;N++){const{data:u,error:v}=await r.rpc("purchase_product",{p_product_id:a.id,p_user_id:t.id});if(v)throw v;if(u&&u.success===!1)throw new Error(u.message)}s==null||s("Compra realizada com sucesso!","success"),d(null),p("purchase-history")}catch(t){s==null||s(t.message||"Tente novamente","error")}finally{g(!1)}})};return e.jsxs("div",{className:"bg-white min-h-screen text-slate-900 font-sans antialiased pb-32",children:[e.jsx("main",{className:"max-w-md mx-auto p-4 space-y-5 pt-8",children:w?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx(y,{size:"w-12 h-12"}),e.jsx("p",{className:"text-slate-400 font-medium animate-pulse text-sm",children:"Preparando loja..."})]}):b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center animate-in fade-in zoom-in duration-700",children:[e.jsx("div",{className:"w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mb-6",children:e.jsx("span",{className:"material-symbols-outlined text-slate-300 text-4xl",children:"inventory_2"})}),e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-2",children:"Loja Vazia"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Nenhum produto disponível no momento."})]}):e.jsx("div",{className:"grid grid-cols-1 gap-5",children:b.map((t,n)=>e.jsxs("div",{className:"group relative bg-white rounded-3xl p-4 border border-slate-100 shadow-[0_4px_20px_-10px_rgba(0,0,0,0.1)] transition-all active:scale-[0.98] animate-in slide-in-from-bottom-8 fade-in",style:{animationDelay:`${n*100}ms`,animationFillMode:"both"},children:[t.purchase_limit<=0&&e.jsx("div",{className:"absolute top-4 left-4 bg-red-500 text-white text-[10px] font-bold px-3 py-1 rounded-full z-20 uppercase tracking-widest shadow-lg",children:"Esgotado"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"w-full aspect-square bg-[#F8FAFC] rounded-2xl flex items-center justify-center overflow-hidden border border-slate-50 relative group-hover:shadow-inner",children:[t.image_url?e.jsx("img",{alt:t.name,className:"object-contain w-3/4 h-3/4 scale-110 group-hover:scale-125 transition-transform duration-700 ease-out",src:t.image_url}):e.jsx("span",{className:"material-symbols-outlined text-6xl text-slate-200",children:"devices"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsxs("div",{className:"flex flex-col flex-1 px-1",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-extrabold text-lg text-slate-900 leading-tight uppercase tracking-tight",children:t.name}),e.jsx("div",{className:"bg-primary/10 px-2 py-0.5 rounded-lg",children:e.jsx("span",{className:"text-primary font-black text-xs",children:"NOVO"})})]}),e.jsx("p",{className:"text-xs text-slate-500 mb-4 line-clamp-2 leading-relaxed",children:t.description}),e.jsxs("div",{className:"flex items-center justify-between mt-auto",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-0.5",children:"Preço:"}),e.jsxs("span",{className:"text-2xl font-black text-[#CC0000] tracking-tighter",children:[t.price.toLocaleString()," ",e.jsx("span",{className:"text-sm",children:"Kz"})]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-0.5",children:"Renda/Dia:"}),e.jsxs("span",{className:"text-lg font-black text-green-600 tracking-tighter",children:["+",t.daily_income.toLocaleString()," ",e.jsx("span",{className:"text-xs",children:"Kz"})]})]})]}),e.jsx("button",{onClick:()=>_(t),disabled:t.purchase_limit<=0,className:`w-full mt-5 py-4 rounded-2xl text-sm font-black uppercase tracking-widest transition-all shadow-lg active:scale-95 ${t.purchase_limit>0?"bg-blue-600 hover:bg-blue-700 text-white shadow-blue-200":"bg-slate-100 text-slate-400 cursor-not-allowed shadow-none"}`,children:"Comprar Agora"})]})]})]},t.id))})}),a&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-300",children:[e.jsx("div",{className:"absolute inset-0",onClick:()=>!o&&d(null)}),e.jsxs("div",{className:"relative w-full max-w-[320px] bg-white rounded-[40px] p-8 shadow-2xl animate-in zoom-in-95 slide-in-from-bottom-10 duration-500 border border-slate-100 flex flex-col items-center",children:[e.jsx("div",{className:"w-20 h-20 bg-slate-50 rounded-3xl flex items-center justify-center mb-6 border border-slate-100 overflow-hidden",children:a.image_url?e.jsx("img",{src:a.image_url,alt:a.name,className:"w-3/4 h-3/4 object-contain"}):e.jsx("span",{className:"material-symbols-outlined text-4xl text-slate-200",children:"shopping_bag"})}),e.jsx("h3",{className:"text-xl font-black text-slate-900 mb-2 uppercase tracking-tight text-center",children:a.name}),e.jsx("p",{className:"text-sm text-slate-400 font-medium mb-8 px-2 text-center",children:"Confirme a quantidade que deseja adquirir para iniciar seus rendimentos."}),e.jsxs("div",{className:"flex items-center justify-center gap-8 mb-8 w-full",children:[e.jsx("button",{onClick:()=>m(t=>Math.max(1,t-1)),className:"size-12 rounded-2xl border-2 border-slate-100 flex items-center justify-center text-slate-900 hover:bg-slate-50 active:scale-90 transition-all font-bold text-xl",children:e.jsx("span",{className:"material-symbols-outlined text-[24px]",children:"remove"})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-3xl font-black text-slate-900 leading-none",children:l}),e.jsx("span",{className:"text-[10px] text-slate-400 font-black uppercase tracking-widest mt-2",children:"unid"})]}),e.jsx("button",{onClick:()=>m(t=>t+1),className:"size-12 rounded-2xl border-2 border-slate-100 flex items-center justify-center text-slate-900 hover:bg-slate-50 active:scale-90 transition-all font-bold text-xl bg-slate-50",children:e.jsx("span",{className:"material-symbols-outlined text-[24px]",children:"add"})})]}),e.jsxs("div",{className:"bg-[#F8FAFC] rounded-3xl p-5 border border-slate-100 mb-8 w-full flex justify-between items-center shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Total do Investimento:"}),e.jsxs("span",{className:"text-xl font-black text-blue-600",children:[(a.price*l).toLocaleString()," ",e.jsx("span",{className:"text-xs",children:"Kz"})]})]}),e.jsxs("div",{className:"flex flex-col w-full gap-3",children:[e.jsx("button",{disabled:o||c<a.price*l,onClick:C,className:`w-full py-4 rounded-2xl font-black text-sm uppercase tracking-widest transition-all active:scale-95 shadow-lg ${c>=a.price*l?"bg-blue-600 text-white shadow-blue-200":"bg-slate-100 text-slate-300 cursor-not-allowed"}`,children:o?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(y,{size:"w-4 h-4"}),e.jsx("span",{children:"Processando..."})]}):c<a.price*l?"Saldo Insuficiente":"Confirmar Compra"}),e.jsx("button",{disabled:o,onClick:()=>d(null),className:"w-full py-3 text-slate-400 font-bold text-xs uppercase tracking-widest hover:text-slate-600 transition-colors",children:"Cancelar"})]})]})]})]})};export{P as default};
