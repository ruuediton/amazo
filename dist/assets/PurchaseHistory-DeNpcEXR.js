import{r as d,s as l,j as e,S as N}from"./index-BauRbZeW.js";const v=({onNavigate:i,showToast:n})=>{const[c,h]=d.useState([]),[g,x]=d.useState(!0);d.useEffect(()=>{let t;const a=async()=>{const{data:{user:s}}=await l.auth.getUser();s&&(t=l.channel(`purchases-realtime-${s.id}`).on("postgres_changes",{event:"*",schema:"public",table:"historico_compras",filter:`user_id=eq.${s.id}`},()=>{m(!1)}).subscribe())};return m(!0),a(),()=>{t&&t.unsubscribe()}},[]);const m=async(t=!1)=>{t&&x(!0);const{data:{user:a}}=await l.auth.getUser();if(!a){i("login");return}try{const{data:s,error:b}=await l.from("historico_compras").select("*").eq("user_id",a.id).order("data_compra",{ascending:!1});if(b)throw b;const{data:o,error:u}=await l.from("products").select("name, image_url");if(u)throw u;const f={};o==null||o.forEach(r=>{f[r.name.trim().toLowerCase()]=r.image_url});const j=s==null?void 0:s.map(r=>({...r,image_url:f[r.nome_produto.trim().toLowerCase()]||null}));h(j||[])}catch(s){console.error(s),n==null||n("Erro ao carregar histórico","error")}finally{x(!1)}},p={pendente:{icon:"history",color:"text-amber-500",bg:"bg-amber-50",border:"border-amber-100",label:"Pendente"},confirmado:{icon:"verified",color:"text-green-600",bg:"bg-green-50",border:"border-green-100",label:"Ativo"},cancelado:{icon:"cancel",color:"text-red-500",bg:"bg-red-50",border:"border-red-100",label:"Cancelado"}};return e.jsxs("div",{className:"flex flex-col min-h-screen bg-[#F8FAFC] font-sans text-slate-900 antialiased",children:[e.jsxs("header",{className:"sticky top-0 z-50 flex items-center bg-white/80 backdrop-blur-xl p-4 border-b border-slate-100",children:[e.jsx("button",{onClick:()=>i("profile"),className:"size-10 flex items-center justify-center bg-slate-50 rounded-full hover:bg-slate-100 transition-all active:scale-90",children:e.jsx("span",{className:"material-symbols-outlined text-[20px] text-slate-600",children:"arrow_back"})}),e.jsx("h2",{className:"text-slate-900 text-base font-black uppercase tracking-widest flex-1 text-center pr-10",children:"Meus Investimentos"})]}),e.jsxs("main",{className:"flex-1 flex flex-col px-4 pt-6 pb-32 max-w-md mx-auto w-full",children:[g?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx(N,{size:"w-10 h-10"}),e.jsx("p",{className:"text-slate-400 font-bold text-xs uppercase tracking-widest animate-pulse",children:"Sincronizando..."})]}):c.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center px-10 animate-in fade-in zoom-in duration-700",children:[e.jsx("div",{className:"size-20 rounded-[32px] bg-white flex items-center justify-center mb-6 shadow-xl border border-slate-50",children:e.jsx("span",{className:"material-symbols-outlined text-slate-300 text-4xl",children:"inventory"})}),e.jsx("h3",{className:"text-slate-900 font-black text-lg mb-2 uppercase tracking-tight",children:"Sem Ativos"}),e.jsx("p",{className:"text-slate-400 text-sm leading-relaxed mb-8 font-medium",children:"Você ainda não possui investimentos ativos em sua carteira."}),e.jsx("button",{onClick:()=>i("shop"),className:"w-full h-14 bg-blue-600 text-white font-black uppercase tracking-widest rounded-2xl hover:bg-blue-700 active:scale-95 transition-all shadow-lg shadow-blue-100",children:"Explorar Loja"})]}):e.jsx("div",{className:"flex flex-col gap-6",children:c.map((t,a)=>{const s=p[t.status]||p.pendente;return e.jsxs("div",{className:"bg-white rounded-[32px] p-5 shadow-[0_4px_20px_-10px_rgba(0,0,0,0.1)] border border-slate-100 animate-in slide-in-from-bottom-10 fade-in duration-500",style:{animationDelay:`${a*100}ms`,animationFillMode:"both"},children:[e.jsxs("div",{className:"flex gap-5",children:[e.jsx("div",{className:"size-20 shrink-0 rounded-2xl bg-[#F8FAFC] flex items-center justify-center border border-slate-50 overflow-hidden shadow-inner group",children:t.image_url?e.jsx("img",{src:t.image_url,alt:t.nome_produto,className:"w-4/5 h-4/5 object-contain scale-110 group-hover:scale-125 transition-transform"}):e.jsx("span",{className:"material-symbols-outlined text-3xl text-slate-200",children:"devices"})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[e.jsxs("div",{className:"flex justify-between items-start w-full mb-1",children:[e.jsx("h3",{className:"text-slate-900 text-[13px] font-black uppercase tracking-tight truncate pr-2",children:t.nome_produto}),e.jsxs("div",{className:`flex items-center gap-1 px-3 py-1 rounded-full ${s.bg} border ${s.border}`,children:[e.jsx("span",{className:`material-symbols-outlined text-[14px] ${s.color}`,children:s.icon}),e.jsx("span",{className:`${s.color} text-[9px] font-black uppercase tracking-widest`,children:s.label})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-slate-400 font-black uppercase tracking-widest",children:"Valor Investido"}),e.jsxs("span",{className:"text-lg font-black text-slate-900 tracking-tighter",children:[(Number(t.preco)||0).toLocaleString()," ",e.jsx("span",{className:"text-xs",children:"Kz"})]})]})]})]}),e.jsxs("div",{className:"mt-5 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-[#F8FAFC] rounded-2xl p-3 border border-slate-50",children:[e.jsx("span",{className:"text-[9px] text-slate-400 uppercase font-black tracking-widest block mb-0.5",children:"Retorno Diário"}),e.jsxs("span",{className:"text-sm text-green-600 font-extrabold",children:["+",(Number(t.rendimento_diario)||0).toLocaleString()," Kz"]})]}),e.jsxs("div",{className:"bg-[#F8FAFC] rounded-2xl p-3 border border-slate-50",children:[e.jsx("span",{className:"text-[9px] text-slate-400 uppercase font-black tracking-widest block mb-0.5",children:"Expiração"}),e.jsx("span",{className:"text-sm text-slate-900 font-extrabold",children:new Date(t.data_expiracao).toLocaleDateString("pt-PT",{day:"2-digit",month:"2-digit"})})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between px-1",children:[e.jsxs("span",{className:"text-[10px] text-slate-300 font-bold",children:["Ref: #AMZ-",t.id]}),e.jsxs("span",{className:"text-[10px] text-slate-400 font-bold flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-[14px]",children:"event"}),new Date(t.data_compra).toLocaleDateString("pt-PT",{day:"2-digit",month:"short"})]})]})]},t.id)})}),c.length>0&&e.jsx("div",{className:"mt-12 text-center pb-10",children:e.jsx("span",{className:"text-slate-300 text-[9px] font-black uppercase tracking-[0.3em]",children:"Cofre Digital Criptografado"})})]})]})};export{v as default};
