import{a as k,u as _,r,s as n,j as e,S as C}from"./index-BauRbZeW.js";const $=({onNavigate:c,onOpenSupport:o,showToast:d})=>{const{runWithTimeout:f}=k(),{withLoading:g}=_(),[x,u]=r.useState(""),[l,L]=r.useState(!1),[t,b]=r.useState(!1),[i,j]=r.useState(null),[h,y]=r.useState([]),[w,N]=r.useState(!0);r.useEffect(()=>{p()},[]);const p=async()=>{try{const{data:{user:s}}=await n.auth.getUser();if(!s)return;const{data:a,error:m}=await f(()=>n.from("bonus_transacoes").select("*").eq("user_id",s.id).order("data_recebimento",{ascending:!1}).limit(10));!m&&a&&y(a)}catch{}finally{N(!1)}},v=async()=>{if(!x.trim()){d==null||d("Por favor, digite código.","warning");return}await g(async()=>{const{data:{user:s}}=await n.auth.getUser();if(!s)throw c("login"),new Error("Sessão expirada.");const{data:a,error:m}=await n.rpc("redeem_gift_code",{p_code:x.trim()});if(m)throw new Error("Não foi possível processar o pedido. Tente novamente.");if(!a.success)throw new Error(a.message||"Código inválido ou expirado.");return j(a.amount||0),b(!0),u(""),p(),a.message},"Resgate sucedido!")};return e.jsxs("div",{className:"bg-background-dark text-black min-h-screen flex flex-col font-display antialiased",children:[e.jsxs("div",{className:"flex items-center bg-background-dark p-4 pb-2 justify-between sticky top-0 z-50",children:[e.jsx("div",{onClick:()=>c("home"),className:"text-primary flex size-12 shrink-0 items-center cursor-pointer hover:bg-white/10 rounded-full justify-center transition-colors",children:e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"})}),e.jsx("h2",{className:"text-black text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center",children:"amazon"}),e.jsx("div",{className:"flex w-12 items-center justify-end",children:e.jsx("button",{onClick:()=>o==null?void 0:o(),className:"flex cursor-pointer items-center justify-center rounded-lg h-12 bg-transparent text-black p-0",children:e.jsx("span",{className:"material-symbols-outlined",children:"help_outline"})})})]}),e.jsxs("main",{className:"flex-1 flex flex-col justify-center items-center px-4 max-w-lg mx-auto w-full pb-20",children:[e.jsx("div",{className:"mb-4",children:e.jsx("span",{className:"bg-primary/20 text-primary px-4 py-1.5 rounded-full text-xs font-black uppercase tracking-widest border border-primary/20",children:"Parabéns!"})}),e.jsx("h1",{className:"text-black tracking-tight text-[32px] font-extrabold leading-tight px-4 text-center pb-2",children:t?"Presente Aberto!":"Tens um presente para abrir!"}),e.jsx("p",{className:"text-black/70 text-base font-medium leading-relaxed pb-8 px-8 text-center",children:t?`Parabéns! Acabaste de resgatar Kz ${i==null?void 0:i.toLocaleString()}. O valor já foi adicionado ao teu saldo.`:"Tens um código? Introduz abaixo para resgatar o teu presente agora."}),!t&&e.jsx("div",{className:"w-full px-4 mb-10",children:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"relative group",children:[e.jsx("input",{className:"flex w-full rounded-2xl border-2 border-gray-200 bg-gray-50 px-5 h-16 text-lg font-bold focus:border-primary focus:ring-0 focus:outline-none transition-all placeholder:text-gray-400 text-black shadow-inner",placeholder:"Insira o seu código aqui",value:x,onChange:s=>u(s.target.value.toUpperCase()),disabled:l}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-primary",children:e.jsx("span",{className:"material-symbols-outlined text-3xl",children:"redeem"})})]})})}),e.jsxs("div",{className:"relative w-full aspect-square max-w-[280px] mb-8 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_rgba(244,209,37,0.15)_0%,_rgba(24,23,17,0)_70%)] rounded-full"}),e.jsxs("div",{className:`relative w-64 h-64 bg-[#2a2820] rounded-2xl border-4 transition-all duration-700 ${t?"border-primary shadow-[0_0_80px_rgba(244,209,37,0.4)] scale-110":"border-[#3a3830] shadow-[0_30px_60px_-12px_rgba(0,0,0,0.5)]"} flex flex-col overflow-hidden`,children:[e.jsx("div",{className:`h-1/3 bg-[#323028] border-b-4 transition-all duration-700 ${t?"border-primary/60 -translate-y-4":"border-primary/30"} flex items-center justify-center shadow-inner`,children:e.jsx("div",{className:`w-16 h-2 rounded-full transition-colors ${t?"bg-primary":"bg-primary/10"}`})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center relative bg-gradient-to-b from-[#2d2b22] to-[#1e1c14]",children:[e.jsx("div",{className:`w-20 h-20 rounded-full flex items-center justify-center transition-all duration-700 ${t?"bg-green-500 shadow-[0_0_40px_rgba(34,197,94,0.6)]":"bg-primary shadow-[0_0_30px_rgba(244,209,37,0.5)] animate-pulse"}`,children:e.jsx("span",{className:"material-symbols-outlined text-[#181711] text-5xl font-black transition-all",style:{fontVariationSettings:"'FILL' 1"},children:t?"lock_open":"lock"})}),t&&e.jsx("div",{className:"absolute inset-x-0 bottom-4 flex flex-col items-center animate-bounce",children:e.jsxs("p",{className:"text-primary text-2xl font-black tracking-tighter shadow-sm",children:["+ Kz ",i]})}),e.jsx("div",{className:"absolute top-4 left-4 w-2 h-2 rounded-full bg-white/10 shadow-inner"}),e.jsx("div",{className:"absolute top-4 right-4 w-2 h-2 rounded-full bg-white/10 shadow-inner"}),e.jsx("div",{className:"absolute bottom-4 left-4 w-2 h-2 rounded-full bg-white/10 shadow-inner"}),e.jsx("div",{className:"absolute bottom-4 right-4 w-2 h-2 rounded-full bg-white/10 shadow-inner"})]}),e.jsx("div",{className:`h-6 transition-colors ${t?"bg-primary/20":"bg-black/20"}`})]}),e.jsxs("div",{className:"absolute bottom-2 right-2 bg-primary text-[#181711] font-black px-4 py-2 rounded-xl shadow-2xl rotate-12 flex items-center gap-1.5 border-2 border-[#181711]/10",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",style:{fontVariationSettings:"'FILL' 1"},children:"payments"}),e.jsx("span",{className:"text-lg",children:"Kz"})]})]}),e.jsxs("div",{className:"w-full space-y-4 px-4",children:[t?e.jsx("button",{onClick:()=>b(!1),className:"flex w-full items-center justify-center overflow-hidden rounded-2xl h-16 bg-white border-2 border-primary text-text-primary text-xl font-black leading-normal tracking-wide active:scale-95 transition-all shadow-md",children:e.jsx("span",{children:"Resgatar Outro"})}):e.jsx("button",{onClick:v,disabled:l,className:`flex w-full items-center justify-center overflow-hidden rounded-2xl h-16 bg-primary text-[#181711] text-xl font-black leading-normal tracking-wide shadow-[0_8px_30px_rgba(244,209,37,0.3)] active:scale-95 transition-all ${l?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:e.jsx("span",{className:"truncate",children:l?"A processar...":"Abrir Presente Agora"})}),e.jsx("button",{onClick:()=>c("home"),className:"w-full text-center text-black/50 text-sm font-bold py-2 tracking-widest uppercase hover:text-black transition-colors",children:"Guardar para mais tarde"})]}),e.jsxs("div",{className:"w-full mt-10 px-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-2",children:[e.jsx("h3",{className:"text-black text-lg font-bold",children:"Presentes Resgatados"}),e.jsx("span",{className:"text-primary text-sm font-bold cursor-pointer",children:"Ver todos"})]}),e.jsx("div",{className:"flex flex-col gap-3",children:w?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(C,{size:"w-8 h-8"})}):h.length>0?h.map((s,a)=>e.jsxs("div",{className:`flex items-center justify-between p-4 bg-white/50 border rounded-2xl shadow-sm transition-all ${a===0&&t?"border-primary ring-2 ring-primary/20 bg-primary/5 scale-[1.02]":"border-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`size-10 rounded-full flex items-center justify-center ${s.status==="success"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:e.jsx("span",{className:"material-symbols-outlined icon-filled",children:s.status==="success"?"check_circle":"error"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-black font-bold text-sm",children:s.status==="success"?"Resgate Concluído":"Falha no Resgate"}),a===0&&t&&e.jsx("span",{className:"bg-primary text-[#181711] text-[10px] font-black px-1.5 py-0.5 rounded uppercase",children:"Recente"})]}),e.jsxs("p",{className:"text-black/50 text-xs text-left",children:[new Date(s.data_recebimento).toLocaleTimeString()," • ",s.codigo_presente]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`font-black block ${s.status==="success"?"text-green-600":"text-red-400"}`,children:s.status==="success"?`+ Kz ${s.valor_recebido||0}`:"Inválido"}),e.jsx("span",{className:"text-[10px] text-black/40 font-bold uppercase",children:new Date(s.data_recebimento).toLocaleDateString()})]})]},s.id)):e.jsx("div",{className:"text-center py-10 bg-gray-50/50 rounded-2xl border-2 border-dashed border-gray-100",children:e.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"Nenhum presente resgatado ainda."})})})]})]}),e.jsx("div",{className:"h-2 bg-primary/5 w-full mt-auto"})]})};export{$ as default};
