import{r as n,R as z,s as o,j as e,S as m}from"./index-BauRbZeW.js";const W=({onNavigate:f,showToast:t})=>{const[g,B]=n.useState(null),[v,V]=n.useState(null),[y,I]=n.useState(null),[j,L]=n.useState(null),[p,N]=n.useState(!1),[C,w]=n.useState(null),[q,U]=n.useState(!0),[c,$]=n.useState(null),[x,D]=n.useState(10),[h,k]=n.useState(!1),[S,b]=n.useState(!0);z.useEffect(()=>{R();const r=a=>a.preventDefault(),s=()=>b(!document.hidden),l=()=>b(!1),d=()=>b(!0),i=a=>{(a.key==="PrintScreen"||a.metaKey&&a.shiftKey&&(a.key==="3"||a.key==="4"))&&(k(!0),t==null||t("Captura de tela detectada e bloqueada por segurança.","warning"))};return window.addEventListener("contextmenu",r),window.addEventListener("visibilitychange",s),window.addEventListener("blur",l),window.addEventListener("focus",d),window.addEventListener("keydown",i),()=>{window.removeEventListener("contextmenu",r),window.removeEventListener("visibilitychange",s),window.removeEventListener("blur",l),window.removeEventListener("focus",d),window.removeEventListener("keydown",i)}},[]),z.useEffect(()=>{let r;return c&&x>0?r=setInterval(()=>{D(s=>s-1)},1e3):x===0&&k(!0),()=>clearInterval(r)},[c,x]);const _=r=>{try{return atob(r.split("").reverse().join(""))}catch{return r}},R=async()=>{try{const{data:{user:r}}=await o.auth.getUser();if(!r)return;const{data:s,error:l}=await o.from("profiles").select("verified, bi_frente_url, bi_verso_url").eq("user_id",r.id).single();if(!l&&s&&s.verified){w(!0);const d=_(s.bi_frente_url).replace("documents/",""),i=_(s.bi_verso_url).replace("documents/",""),{data:a}=await o.storage.from("documents").createSignedUrl(d,60),{data:u}=await o.storage.from("documents").createSignedUrl(i,60);a!=null&&a.signedUrl&&(u!=null&&u.signedUrl)&&$({frente:a.signedUrl,verso:u.signedUrl})}}catch(r){console.error("Erro ao verificar status:",r)}finally{U(!1)}},P=r=>btoa(r).split("").reverse().join(""),E=(r,s)=>{var d;const l=(d=r.target.files)==null?void 0:d[0];if(l){if(l.size>5*1024*1024){t==null||t("O arquivo é muito grande. O máximo é 5MB.","warning");return}const i=new FileReader;i.onloadend=()=>{s==="frente"?(B(l),I(i.result)):(V(l),L(i.result))},i.readAsDataURL(l)}},G=async()=>{if(!g||!v){t==null||t("Por favor, carregue as imagens da frente e do verso do seu BI.","warning");return}N(!0);try{const{data:{user:r}}=await o.auth.getUser();if(!r){t==null||t("Usuário não autenticado.","error");return}const s=r.id,l=`${s}/bi_frente_${Date.now()}`,{error:d}=await o.storage.from("documents").upload(l,g,{upsert:!0});if(d)throw d;const i=`${s}/bi_verso_${Date.now()}`,{error:a}=await o.storage.from("documents").upload(i,v,{upsert:!0});if(a)throw a;const u=P(`documents/${l}`),M=P(`documents/${i}`),{error:F}=await o.from("profiles").update({bi_frente_url:u,bi_verso_url:M,verified:!0}).eq("user_id",s);if(F)throw F;t==null||t("Documentos enviados e verificados com sucesso!","success"),w(!0),setTimeout(()=>f("profile"),2e3)}catch(r){console.error("Erro na verificação:",r),t==null||t("Erro ao processar verificação: "+(r.message||"Erro desconhecido"),"error")}finally{N(!1)}};return q?e.jsx("div",{className:"bg-background-dark min-h-screen flex items-center justify-center",children:e.jsx(m,{size:"w-10 h-10"})}):C?e.jsx("div",{className:"bg-background-dark font-display text-black antialiased min-h-screen flex flex-col items-center justify-center px-6 py-12",children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-6 w-full max-w-sm",children:[e.jsx("div",{className:"size-20 rounded-full bg-primary/20 flex items-center justify-center border-4 border-primary/30",children:e.jsx("span",{className:"material-symbols-outlined text-primary",style:{fontSize:"48px",fontWeight:"bold"},children:"verified_user"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-black text-black",children:"Conta Verificada"}),h?e.jsx("p",{className:"text-red-400 text-sm font-medium animate-pulse",children:"Por questões de segurança, o tempo de leitura terminou."}):e.jsxs("p",{className:"text-text-secondary text-sm font-medium",children:["Sua identidade foi confirmada. As imagens serão ocultadas em ",e.jsxs("span",{className:"text-primary font-bold",children:[x,"s"]}),"."]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 w-full",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("p",{className:"text-left text-xs font-bold text-gray-500 mb-2 uppercase tracking-widest",children:"BI Frente"}),e.jsx("div",{className:`aspect-[1.6/1] rounded-2xl overflow-hidden border-2 border-gray-200 bg-surface-dark transition-all duration-700 ${h?"blur-xl scale-95 opacity-50":""}`,children:c!=null&&c.frente?e.jsx("img",{src:c.frente,alt:"Frente",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(m,{size:"w-6 h-6"})})})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("p",{className:"text-left text-xs font-bold text-gray-500 mb-2 uppercase tracking-widest",children:"BI Verso"}),e.jsx("div",{className:`aspect-[1.6/1] rounded-2xl overflow-hidden border-2 border-gray-200 bg-surface-dark transition-all duration-700 ${h?"blur-xl scale-95 opacity-50":""}`,children:c!=null&&c.verso?e.jsx("img",{src:c.verso,alt:"Verso",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(m,{size:"w-6 h-6"})})})]})]}),e.jsx("button",{onClick:()=>f("profile"),className:"w-full mt-4 bg-primary hover:bg-yellow-400 text-black font-black text-lg py-4 rounded-2xl transition-all shadow-xl shadow-primary/20 active:scale-[0.98]",children:"Sair"})]})}):e.jsxs("div",{className:`bg-background-dark font-display text-black antialiased min-h-screen flex flex-col selection:bg-primary selection:text-black transition-all duration-500 ${S?"":"blur-2xl opacity-50 scale-95 pointer-events-none"}`,style:{userSelect:"none",WebkitUserSelect:"none"},children:[!S&&e.jsxs("div",{className:"fixed inset-0 z-[999] bg-black/80 backdrop-blur-3xl flex flex-col items-center justify-center text-center p-6",children:[e.jsx("span",{className:"material-symbols-outlined text-primary text-6xl mb-4",children:"security"}),e.jsx("h2",{className:"text-xl font-bold text-black mb-2",children:"Página Protegida"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Por segurança, o conteúdo é ocultado quando você sai da página ou tenta capturá-lo."})]}),e.jsxs("div",{className:"relative flex h-full min-h-screen w-full flex-col overflow-x-hidden max-w-md mx-auto shadow-2xl",children:[e.jsxs("header",{className:"flex items-center px-4 py-3 justify-between sticky top-0 z-10 bg-background-dark/95 backdrop-blur-sm border-b border-gray-200",children:[e.jsx("button",{onClick:()=>f("profile"),className:"flex size-10 shrink-0 items-center justify-center rounded-full hover:bg-white/10 transition-colors text-primary",children:e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"24px"},children:"arrow_back"})}),e.jsx("h2",{className:"text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-10",children:"Verificação de Conta"})]}),e.jsxs("div",{className:"flex w-full flex-col items-center justify-center py-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-1.5 w-10 rounded-full bg-primary"}),e.jsx("div",{className:"h-1.5 w-10 rounded-full bg-primary"}),e.jsx("div",{className:"h-1.5 w-10 rounded-full bg-primary"})]}),e.jsx("p",{className:"text-xs font-bold text-gray-500 mt-3 uppercase tracking-widest",children:"Finalizando"})]}),e.jsxs("div",{className:"px-6 pb-8",children:[e.jsx("h1",{className:"text-[32px] font-extrabold leading-tight text-center pb-3",children:"Verifique sua identidade"}),e.jsx("p",{className:"text-base font-medium leading-relaxed text-center text-text-secondary",children:"Para garantir a segurança da sua conta, precisamos de uma foto nítida do seu Bilhete de Identidade (BI)."})]}),e.jsxs("div",{className:"flex flex-col gap-6 px-6 flex-1",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("h3",{className:"text-lg font-bold leading-tight tracking-tight",children:"BI Frente"}),e.jsxs("label",{className:"group relative flex flex-col items-center justify-center w-full h-48 rounded-2xl border-2 border-dashed border-gray-700 bg-surface-dark/50 hover:bg-primary/5 hover:border-primary transition-all cursor-pointer overflow-hidden",children:[y?e.jsx("img",{src:y,alt:"Preview",className:"w-full h-full object-cover"}):e.jsxs("div",{className:"flex flex-col items-center gap-4 z-10",children:[e.jsx("div",{className:"h-14 w-14 rounded-full bg-primary/10 flex items-center justify-center group-hover:scale-110 transition-transform duration-300",children:e.jsx("span",{className:"material-symbols-outlined text-primary",style:{fontSize:"28px"},children:"add_a_photo"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-bold text-black",children:"Toque para carregar"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1.5 font-medium",children:"PNG, JPG ou PDF (max. 5MB)"})]})]}),e.jsx("input",{accept:"image/*",className:"hidden",type:"file",onChange:r=>E(r,"frente")})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("h3",{className:"text-lg font-bold leading-tight tracking-tight",children:"BI Verso"}),e.jsxs("label",{className:"group relative flex flex-col items-center justify-center w-full h-48 rounded-2xl border-2 border-dashed border-gray-700 bg-surface-dark/50 hover:bg-primary/5 hover:border-primary transition-all cursor-pointer overflow-hidden",children:[j?e.jsx("img",{src:j,alt:"Preview",className:"w-full h-full object-cover"}):e.jsxs("div",{className:"flex flex-col items-center gap-4 z-10",children:[e.jsx("div",{className:"h-14 w-14 rounded-full bg-primary/10 flex items-center justify-center group-hover:scale-110 transition-transform duration-300",children:e.jsx("span",{className:"material-symbols-outlined text-primary",style:{fontSize:"28px"},children:"add_a_photo"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-bold text-black",children:"Toque para carregar"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1.5 font-medium",children:"PNG, JPG ou PDF (max. 5MB)"})]})]}),e.jsx("input",{accept:"image/*",className:"hidden",type:"file",onChange:r=>E(r,"verso")})]})]}),e.jsxs("div",{className:"flex items-start gap-4 p-5 bg-primary/10 rounded-2xl mt-2 border border-primary/10",children:[e.jsx("div",{className:"size-8 rounded-full bg-primary flex items-center justify-center shrink-0",children:e.jsx("span",{className:"material-symbols-outlined text-black",style:{fontSize:"18px",fontWeight:"bold"},children:"info"})}),e.jsx("p",{className:"text-sm text-text-secondary leading-relaxed font-medium",children:"Certifique-se de que todas as informações no seu BI estão legíveis e sem reflexos."})]}),e.jsx("div",{className:"h-12"})]}),e.jsxs("div",{className:"sticky bottom-0 w-full p-6 bg-background-dark/90 backdrop-blur-xl border-t border-gray-200",children:[e.jsx("button",{onClick:G,disabled:p,className:`w-full flex items-center justify-center gap-3 bg-primary hover:bg-yellow-400 text-black font-black text-lg py-4 rounded-2xl transition-all shadow-xl shadow-primary/20 active:scale-[0.98] ${p?"opacity-50 cursor-not-allowed":""}`,children:p?e.jsx(m,{size:"w-6 h-6",className:"text-black"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Enviar para Verificação"}),e.jsx("span",{className:"material-symbols-outlined font-bold",children:"arrow_forward"})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-5 opacity-40",children:[e.jsx("span",{className:"material-symbols-outlined text-[16px]",children:"lock"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.1em]",children:"Encriptação de ponta a ponta"})]})]})]})]})};export{W as default};
